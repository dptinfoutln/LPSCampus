version: '3.1'

services:
    service-proxy:
        image: nginx:latest
        container_name: service-proxy
        depends_on:
            - service-localisation
            - service-java
        volumes:
            - ./service-proxy/nginx.conf:/etc/nginx/nginx.conf
            - ./service-proxy/:/www/data
            - /etc/letsencrypt:/etc/letsencrypt
        ports:
            - 8044:80
            - 4430:443

    service-localisation:
        image: service-localisation
        container_name: service-localisation
        depends_on:
            - service-java
        links: 
            - "service-java:serveurSGBD"
        build:
            context: ../../
            dockerfile: ./Cloud/Docker/service-localisation/Dockerfile
        ports:
            - 5000:5000
        restart: on-failure

    service-java:
        image: service-java
        container_name: service-java
        depends_on:
            - service-db
        links: 
            - "service-db:database"
        build:
            context: ../../
            dockerfile: ./Cloud/Docker/service-java/Dockerfile
        ports:
            - 9998:9998
 
    service-db:
        image: mariadb:10.4
        container_name: service-db
        environment:
            MYSQL_ROOT_PASSWORD: changeme
            MYSQL_DATABASE: mybb
            MYSQL_USER: mybb
            MYSQL_PASSWORD: changeme
        ports:
            - 3306:3306
        restart: on-failure
        volumes:
            - ./service-db/database:/var/lib/mysql
            - ./service-db/conf:/etc/mysql
            
            

